<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Research Agent Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
:root {
    --primary: #3b82f6;
    --primary-dark: #2563eb;
    --primary-light: #93c5fd;
    --secondary: #475569;
    --accent: #8b5cf6;
    --success: #10b981;
    --danger: #ef4444;
    --warning: #f59e0b;
    --info: #0ea5e9;
    --light: #f8fafc;
    --dark: #1e293b;
    --card-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --card-shadow-hover: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    --font-primary: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    --transition-fast: 0.3s ease;
    --transition-medium: 0.5s ease;
    --transition-slow: 0.8s cubic-bezier(0.215, 0.610, 0.355, 1.000);
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: var(--font-primary);
    line-height: 1.7;
    color: var(--dark);
    background-color: #f3f4f6;
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

.container {
    max-width: 1280px;
    margin: 0 auto;
    padding: 0 2rem;
}

/* Scrollbar Styling */
::-webkit-scrollbar {
    width: 10px;
    height: 10px;
}

::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 5px;
}

::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 5px;
    transition: var(--transition-fast);
}

::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

/* Header */
header {
    background-color: white;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 100;
    backdrop-filter: blur(10px);
    transition: var(--transition-fast);
}

header.scrolled {
    background-color: rgba(255, 255, 255, 0.8);
}

.header-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 80px;
    transition: var(--transition-fast);
}

.header-scrolled .header-container {
    height: 60px;
}

.logo {
    display: flex;
    align-items: center;
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--primary);
    text-decoration: none;
    transition: var(--transition-fast);
}

.logo:hover {
    transform: scale(1.05);
}

.logo-icon {
    margin-right: 0.75rem;
    font-size: 1.75rem;
    position: relative;
    transition: var(--transition-medium);
    display: inline-block;
}

.logo:hover .logo-icon {
    transform: rotate(360deg);
}

.logo-text span {
    background: linear-gradient(to right, var(--primary), var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    position: relative;
}

.logo-text span::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 0;
    height: 2px;
    background: linear-gradient(to right, var(--primary), var(--accent));
    transition: var(--transition-fast);
}

.logo:hover .logo-text span::after {
    width: 100%;
}

.header-controls {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.theme-toggle {
    background: none;
    border: none;
    font-size: 1.2rem;
    color: var(--dark);
    cursor: pointer;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition-fast);
}

.theme-toggle:hover {
    background-color: rgba(0, 0, 0, 0.05);
    transform: rotate(30deg);
}

.user-profile {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    padding: 0.5rem 1rem;
    border-radius: 50px;
    transition: var(--transition-fast);
}

.user-profile:hover {
    background-color: rgba(0, 0, 0, 0.05);
}

.user-avatar {
    width: 34px;
    height: 34px;
    border-radius: 50%;
    background-color: var(--primary-light);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary-dark);
    font-weight: 600;
    font-size: 0.9rem;
}

.user-info {
    display: none;
}

/* Main Content */
main {
    margin-top: 120px;
    padding-bottom: 2rem;
    min-height: calc(100vh - 80px - 60px);
    transition: var(--transition-fast);
}

/* Card Styling */
.card {
    background: white;
    border-radius: 16px;
    box-shadow: var(--card-shadow);
    transition: var(--transition-fast);
    overflow: hidden;
    margin-bottom: 2rem;
}

.card:hover {
    box-shadow: var(--card-shadow-hover);
}

.card-header {
    padding: 1.5rem 2rem;
    background: linear-gradient(to right, rgba(59, 130, 246, 0.05), rgba(139, 92, 246, 0.05));
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.card-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--dark);
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.card-title i {
    color: var(--primary);
}

.card-body {
    padding: 2rem;
}

/* Form Elements */
.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.75rem;
    font-weight: 600;
    color: var(--dark);
    font-size: 1.1rem;
}

.form-control {
    width: 100%;
    padding: 1rem 1.25rem;
    font-size: 1rem;
    line-height: 1.5;
    color: var(--dark);
    background-color: #fff;
    background-clip: padding-box;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    transition: var(--transition-fast);
    font-family: inherit;
}

.form-control:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
}

textarea.form-control {
    min-height: 150px;
    resize: vertical;
}

.form-select {
    display: block;
    width: 100%;
    padding: 1rem 2.5rem 1rem 1.25rem;
    -moz-padding-start: calc(1.25rem - 3px);
    font-size: 1rem;
    font-weight: 500;
    line-height: 1.5;
    color: var(--dark);
    background-color: #fff;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%232563eb' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 1.25rem center;
    background-size: 16px 12px;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    transition: var(--transition-fast);
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
}

.form-select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
}

/* Button Styling */
.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.75rem 1.5rem;
    font-weight: 600;
    font-size: 1rem;
    line-height: 1.5;
    text-align: center;
    white-space: nowrap;
    vertical-align: middle;
    border-radius: 12px;
    cursor: pointer;
    transition: var(--transition-fast);
    border: none;
    gap: 0.5rem;
    position: relative;
    overflow: hidden;
}

.btn::after {
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: -100%;
    background: linear-gradient(to right, rgba(255, 255, 255, 0.2), transparent);
    transition: var(--transition-fast);
}

.btn:hover::after {
    left: 100%;
}

.btn i {
    font-size: 1.1rem;
    line-height: 1;
}

.btn-primary {
    background-color: var(--primary);
    color: white;
}

.btn-primary:hover {
    background-color: var(--primary-dark);
    transform: translateY(-3px);
    box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.1), 0 4px 6px -2px rgba(37, 99, 235, 0.05);
}

.btn-danger {
    background-color: var(--danger);
    color: white;
}

.btn-danger:hover {
    background-color: #dc2626;
    transform: translateY(-3px);
    box-shadow: 0 10px 15px -3px rgba(239, 68, 68, 0.1), 0 4px 6px -2px rgba(239, 68, 68, 0.05);
}

.btn-outline {
    background-color: transparent;
    border: 2px solid var(--primary);
    color: var(--primary);
}

.btn-outline:hover {
    background-color: var(--primary);
    color: white;
    transform: translateY(-3px);
}

.btn-icon {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    padding: 0;
    font-size: 1.25rem;
}

.controls {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    margin-top: 2rem;
    justify-content: space-between;
}

.provider-select {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.provider-select label {
    font-weight: 600;
    margin-bottom: 0;
}

.provider-options {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.provider-option {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border-radius: 50px;
    cursor: pointer;
    transition: var(--transition-fast);
    border: 2px solid transparent;
}

.provider-option:hover {
    background-color: rgba(0, 0, 0, 0.05);
}

.provider-option.active {
    border-color: var(--primary);
    background-color: rgba(59, 130, 246, 0.1);
}

.provider-option input {
    display: none;
}

.provider-option i {
    font-size: 1.25rem;
    color: var(--primary);
}

.button-group {
    display: flex;
    gap: 1rem;
}

/* Loading Animation */
.loading {
    display: none;
    padding: 3rem 2rem;
    text-align: center;
}

.loading-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
}

.spinner {
    display: inline-block;
    position: relative;
    width: 80px;
    height: 80px;
}

.spinner div {
    box-sizing: border-box;
    display: block;
    position: absolute;
    width: 64px;
    height: 64px;
    margin: 8px;
    border: 8px solid #3b82f6;
    border-radius: 50%;
    animation: spinner 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;
    border-color: #3b82f6 transparent transparent transparent;
}

.spinner div:nth-child(1) {
    animation-delay: -0.45s;
}

.spinner div:nth-child(2) {
    animation-delay: -0.3s;
}

.spinner div:nth-child(3) {
    animation-delay: -0.15s;
}

@keyframes spinner {
    0% {
        transform: rotate(0deg);
    }
    100% {
        transform: rotate(360deg);
    }
}

.loading-progress {
    width: 100%;
    max-width: 400px;
    height: 8px;
    background-color: #e2e8f0;
    border-radius: 4px;
    overflow: hidden;
    position: relative;
}

.progress-bar {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 0;
    background: linear-gradient(to right, var(--primary), var(--accent));
    border-radius: 4px;
    transition: width 0.3s ease;
}

.loading-phases {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    max-width: 400px;
    margin-top: 0.5rem;
}

.phase {
    font-size: 0.75rem;
    color: var(--secondary);
    opacity: 0.5;
    transition: var(--transition-fast);
}

.phase.active {
    color: var(--primary);
    opacity: 1;
    font-weight: 600;
}

.loading-message {
    font-size: 1.1rem;
    color: var(--dark);
    margin-top: 1rem;
    font-weight: 500;
}

/* Results */
.results {
    display: none;
    animation: fadeInUp 0.8s ease forwards;
}

@keyframes fadeInUp {
    0% {
        opacity: 0;
        transform: translateY(20px);
    }
    100% {
        opacity: 1;
        transform: translateY(0);
    }
}

.result-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid #e2e8f0;
}

.result-title {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--dark);
    margin: 0;
}

.confidence-meter {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.confidence-label {
    font-weight: 600;
    color: var(--dark);
}

.confidence-bar {
    width: 150px;
    height: 8px;
    background-color: #e2e8f0;
    border-radius: 4px;
    overflow: hidden;
}

.confidence-value {
    height: 100%;
    background: linear-gradient(to right, #ef4444, #f59e0b, #10b981);
    border-radius: 4px;
    transition: width 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.confidence-percent {
    font-weight: 700;
    color: var(--dark);
}

.result-metadata {
    display: flex;
    gap: 2rem;
    margin-bottom: 2rem;
    padding: 1.25rem;
    background-color: #f8fafc;
    border-radius: 12px;
    border: 1px solid #e2e8f0;
}

.meta-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.meta-item i {
    font-size: 1.1rem;
    color: var(--primary);
}

.meta-item-label {
    font-weight: 600;
    color: var(--secondary);
    margin-right: 0.25rem;
}

.meta-item-value {
    font-weight: 600;
    color: var(--dark);
}

.tab-buttons {
    display: flex;
    border-bottom: 1px solid #e2e8f0;
    margin-bottom: 2rem;
    gap: 0.5rem;
}

.tab-btn {
    padding: 1rem 1.5rem;
    font-weight: 600;
    color: var(--secondary);
    background: none;
    border: none;
    cursor: pointer;
    transition: var(--transition-fast);
    border-bottom: 3px solid transparent;
    position: relative;
}

.tab-btn::after {
    content: '';
    position: absolute;
    bottom: -3px;
    left: 50%;
    width: 0;
    height: 3px;
    background-color: var(--primary);
    transition: var(--transition-fast);
    transform: translateX(-50%);
}

.tab-btn.active {
    color: var(--primary);
}

.tab-btn.active::after {
    width: 100%;
}

.tab-btn:hover:not(.active) {
    color: var(--primary-dark);
}

.tab-btn:hover:not(.active)::after {
    width: 20%;
}

.tab-content {
    transition: var(--transition-fast);
}

.summary {
    font-size: 1.1rem;
    line-height: 1.8;
    color: var(--dark);
    margin-bottom: 2rem;
}

.highlights {
    background-color: #f8fafc;
    padding: 2rem;
    border-radius: 12px;
    margin-bottom: 2rem;
    border: 1px solid #e2e8f0;
}

.highlights-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--dark);
    margin-top: 0;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.highlights-title i {
    color: var(--primary);
}

.highlight-item {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #e2e8f0;
    animation: fadeInRight 0.5s ease forwards;
    opacity: 0;
}

.highlight-item:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
}

@keyframes fadeInRight {
    0% {
        opacity: 0;
        transform: translateX(-20px);
    }
    100% {
        opacity: 1;
        transform: translateX(0);
    }
}

.highlight-icon {
    width: 30px;
    height: 30px;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: rgba(59, 130, 246, 0.1);
    border-radius: 50%;
    color: var(--primary);
}

.highlight-content {
    flex-grow: 1;
}

.detail-content {
    font-size: 1.1rem;
    line-height: 1.8;
    color: var(--dark);
}

/* Sources Card */
.sources-card {
    margin-top: 2rem;
}

.sources-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.sources-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--dark);
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.sources-title i {
    color: var(--primary);
}

.source-count {
    font-weight: 600;
    color: var(--secondary);
    background-color: #f1f5f9;
    padding: 0.25rem 0.75rem;
    border-radius: 50px;
    font-size: 0.875rem;
}

.source-list {
    list-style: none;
}

.source-item {
    display: flex;
    padding: 1.5rem;
    border-bottom: 1px solid #e2e8f0;
    transition: var(--transition-fast);
    animation: fadeIn 0.5s ease forwards;
    opacity: 0;
}

.source-item:last-child {
    border-bottom: none;
}

.source-item:hover {
    background-color: #f8fafc;
}

@keyframes fadeIn {
    0% {
        opacity: 0;
    }
    100% {
        opacity: 1;
    }
}

.source-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    background-color: #f1f5f9;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 1.5rem;
    flex-shrink: 0;
    transition: var(--transition-fast);
}

.source-item:hover .source-icon {
    background-color: #e2e8f0;
    transform: scale(1.05);
}

.source-icon i {
    font-size: 1.5rem;
    color: var(--primary);
}

.source-content {
    flex-grow: 1;
}

.source-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--dark);
    margin-bottom: 0.5rem;
    transition: var(--transition-fast);
}

.source-item:hover .source-title {
    color: var(--primary);
}

.source-url {
    margin-bottom: 1rem;
    font-size: 0.875rem;
    color: var(--secondary);
    word-break: break-all;
}

.source-url a {
    color: var(--primary);
    text-decoration: none;
    transition: var(--transition-fast);
}

.source-url a:hover {
    text-decoration: underline;
    color: var(--primary-dark);
}

.relevance {
    margin-top: 0.5rem;
}

.relevance-bar {
    height: 6px;
    width: 100%;
    background-color: #e2e8f0;
    border-radius: 3px;
    overflow: hidden;
    margin-bottom: 0.5rem;
}

.relevance-value {
    height: 100%;
    background: linear-gradient(to right, var(--primary), var(--accent));
    border-radius: 3px;
    transition: width 1s cubic-bezier(0.215, 0.610, 0.355, 1.000);
}

.relevance-label {
    display: flex;
    justify-content: space-between;
    font-size: 0.75rem;
    color: var(--secondary);
}

.badge {
    display: inline-flex;
    align-items: center;
    padding: 0.25rem 0.75rem;
    font-size: 0.75rem;
    font-weight: 600;
    border-radius: 50px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.badge-primary {
    background-color: rgba(59, 130, 246, 0.1);
    color: var(--primary);
}

.source-tags {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.5rem;
    flex-wrap: wrap;
}

/* Mobile Optimization */
@media (max-width: 768px) {
    .container {
        padding: 0 1rem;
    }
    
    .header-container {
        height: 70px;
    }
    
    .logo-text {
        font-size: 1.25rem;
    }
    
    .user-profile {
        padding: 0.25rem;
    }
    
    .user-info {
        display: none;
    }
    
    main {
        margin-top: 100px;
    }
    
    .card-header, .card-body {
        padding: 1.25rem;
    }
    
    .controls {
        flex-direction: column;
        align-items: stretch;
        gap: 1rem;
    }
    
    .provider-select {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
    }
    
    .provider-options {
        width: 100%;
        justify-content: space-between;
    }
    
    .button-group {
        width: 100%;
    }
    
    .button-group .btn {
        flex: 1;
    }
    
    .result-metadata {
        flex-direction: column;
        gap: 1rem;
    }
    
    .result-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .confidence-meter {
        width: 100%;
    }
    
    .confidence-bar {
        flex-grow: 1;
    }
    
    .tab-buttons {
        overflow-x: auto;
        white-space: nowrap;
        padding-bottom: 0.5rem;
    }
    
    .source-item {
        flex-direction: column;
    }
    
    .source-icon {
        margin-right: 0;
        margin-bottom: 1rem;
    }
    
    .source-tags {
        margin-top: 0.75rem;
    }
}

/* Footer */
footer {
    background-color: white;
    padding: 2rem 0;
    text-align: center;
    margin-top: 2rem;
    box-shadow: 0 -1px 3px 0 rgba(0, 0, 0, 0.1);
}

.footer-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
}

.footer-logo {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--primary);
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.footer-logo i {
    font-size: 1.5rem;
}

.footer-copyright {
    color: var(--secondary);
    font-size: 0.875rem;
}

.footer-links {
    display: flex;
    gap: 1.5rem;
    margin-top: 0.5rem;
}

.footer-link {
    color: var(--secondary);
    text-decoration: none;
    transition: var(--transition-fast);
    font-size: 0.875rem;
}

.footer-link:hover {
    color: var(--primary);
}

/* Animations */
@keyframes pulse {
    0% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
    100% {
        transform: scale(1);
    }
}

/* Dark Mode Styling */
body.dark-mode {
    background-color: #0f172a;
    color: #f8fafc;
}

body.dark-mode header {
    background-color: #1e293b;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3);
}

body.dark-mode header.scrolled {
    background-color: rgba(30, 41, 59, 0.8);
}

body.dark-mode .logo {
    color: #60a5fa;
}

body.dark-mode .theme-toggle {
    color: #e2e8f0;
}

body.dark-mode .theme-toggle:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

body.dark-mode .user-profile:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

body.dark-mode .user-avatar {
    background-color: #1e40af;
    color: #93c5fd;
}

body.dark-mode .card {
    background-color: #1e293b;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.15);
}

body.dark-mode .card-header {
    background: linear-gradient(to right, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

body.dark-mode .card-title,
body.dark-mode .form-group label {
    color: #f1f5f9;
}

body.dark-mode .form-control,
body.dark-mode .form-select {
    background-color: #334155;
    border-color: #475569;
    color: #f1f5f9;
}

body.dark-mode .form-control:focus,
body.dark-mode .form-select:focus {
    border-color: #60a5fa;
    box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.25);
}

body.dark-mode .form-select {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%2360a5fa' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
}

body.dark-mode .btn-outline {
    border-color: #60a5fa;
    color: #60a5fa;
}

body.dark-mode .btn-outline:hover {
    background-color: #60a5fa;
}

body.dark-mode .provider-option:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

body.dark-mode .provider-option.active {
    border-color: #60a5fa;
    background-color: rgba(96, 165, 250, 0.2);
}

body.dark-mode .provider-option i {
    color: #60a5fa;
}

body.dark-mode .spinner div {
    border-color: #60a5fa transparent transparent transparent;
}

body.dark-mode .loading-progress {
    background-color: #475569;
}

body.dark-mode .phase {
    color: #94a3b8;
}

body.dark-mode .phase.active {
    color: #60a5fa;
}

body.dark-mode .result-metadata,
body.dark-mode .highlights {
    background-color: #0f172a;
    border-color: #334155;
}

body.dark-mode .result-title,
body.dark-mode .confidence-label,
body.dark-mode .confidence-percent,
body.dark-mode .meta-item-value,
body.dark-mode .highlights-title,
body.dark-mode .detail-content,
body.dark-mode .sources-title {
    color: #f1f5f9;
}

body.dark-mode .meta-item-label,
body.dark-mode .phase,
body.dark-mode .meta-item i {
    color: #94a3b8;
}

body.dark-mode .tab-btn {
    color: #94a3b8;
}

body.dark-mode .tab-btn.active {
    color: #60a5fa;
}

body.dark-mode .tab-btn:hover:not(.active) {
    color: #93c5fd;
}

body.dark-mode .tab-btn::after {
    background-color: #60a5fa;
}

body.dark-mode .highlight-item {
    border-bottom-color: #334155;
}

body.dark-mode .highlight-icon {
    background-color: rgba(96, 165, 250, 0.2);
    color: #60a5fa;
}

body.dark-mode .source-item {
    border-bottom-color: #334155;
}

body.dark-mode .source-item:hover {
    background-color: #0f172a;
}

body.dark-mode .source-icon {
    background-color: #0f172a;
}

body.dark-mode .source-item:hover .source-icon {
    background-color: #111827;
}

body.dark-mode .source-title {
    color: #f1f5f9;
}

body.dark-mode .source-url {
    color: #94a3b8;
}

body.dark-mode .source-url a {
    color: #60a5fa;
}

body.dark-mode .source-url a:hover {
    color: #93c5fd;
}

body.dark-mode .relevance-bar {
    background-color: #475569;
}

body.dark-mode .relevance-label {
    color: #94a3b8;
}

body.dark-mode .badge-primary {
    background-color: rgba(96, 165, 250, 0.2);
    color: #60a5fa;
}

body.dark-mode footer {
    background-color: #1e293b;
    box-shadow: 0 -1px 3px 0 rgba(0, 0, 0, 0.3);
}

body.dark-mode .footer-logo {
    color: #60a5fa;
}

body.dark-mode .footer-copyright {
    color: #94a3b8;
}

body.dark-mode .footer-link {
    color: #cbd5e1;
}

body.dark-mode .footer-link:hover {
    color: #60a5fa;
}

/* Advanced Search Features */
.advanced-search {
    margin-top: 1rem;
    overflow: hidden;
    max-height: 0;
    transition: max-height var(--transition-medium);
}

.advanced-search.show {
    max-height: 500px;
}

.advanced-toggle {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 600;
    color: var(--primary);
    margin-top: 1rem;
    cursor: pointer;
    user-select: none;
    transition: var(--transition-fast);
}

.advanced-toggle:hover {
    color: var(--primary-dark);
}

.advanced-toggle i {
    transition: var(--transition-fast);
}

.advanced-toggle.open i {
    transform: rotate(180deg);
}

.advanced-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    padding-top: 1.5rem;
}

.search-filter {
    margin-bottom: 1rem;
}

.search-filter label {
    font-weight: 600;
    margin-bottom: 0.5rem;
    display: block;
    font-size: 0.875rem;
    color: var(--secondary);
}

.search-filter select,
.search-filter input[type="text"],
.search-filter input[type="number"] {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    font-size: 0.875rem;
    transition: var(--transition-fast);
}

.search-filter select:focus,
.search-filter input[type="text"]:focus,
.search-filter input[type="number"]:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
}

.date-range {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.checkbox-group {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    margin-top: 0.5rem;
}

.checkbox-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
}

.checkbox-item input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: var(--primary);
}

/* Responsive improvements */
@media (max-width: 640px) {
    .advanced-options {
        grid-template-columns: 1fr;
    }
    
    .date-range {
        grid-template-columns: 1fr;
    }
}

/* AI Response Styling */
.ai-response {
    position: relative;
    padding-left: 1.5rem;
    margin-bottom: 1.5rem;
}

.ai-response::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 4px;
    background: linear-gradient(to bottom, var(--primary), var(--accent));
    border-radius: 2px;
}

.ai-response p {
    margin-bottom: 1rem;
}

.ai-response p:last-child {
    margin-bottom: 0;
}

/* Tags and Badges */
.tag-cloud {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin: 1rem 0;
}

.tag {
    display: inline-flex;
    align-items: center;
    padding: 0.35rem 0.75rem;
    background-color: rgba(59, 130, 246, 0.1);
    color: var(--primary);
    border-radius: 50px;
    font-size: 0.75rem;
    font-weight: 600;
    transition: var(--transition-fast);
    cursor: pointer;
}

.tag:hover {
    background-color: rgba(59, 130, 246, 0.2);
}

.tag i {
    margin-right: 0.35rem;
    font-size: 0.7rem;
}

/* Tooltip */
.tooltip {
    position: relative;
    display: inline-block;
}

.tooltip .tooltip-text {
    visibility: hidden;
    width: 200px;
    background-color: var(--dark);
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 0.5rem;
    position: absolute;
    z-index: 1;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    opacity: 0;
    transition: opacity var(--transition-fast);
    font-size: 0.75rem;
}

.tooltip .tooltip-text::after {
    content: "";
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: -5px;
    border-width: 5px;
    border-style: solid;
    border-color: var(--dark) transparent transparent transparent;
}

.tooltip:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
}

/* Animation for tab transitions */
.tab-content {
    animation: fadeEffect 0.5s;
}

@keyframes fadeEffect {
    from {opacity: 0; transform: translateY(10px);}
    to {opacity: 1; transform: translateY(0);}
}

/* Utility Classes */
.text-primary {
    color: var(--primary);
}

.text-success {
    color: var(--success);
}

.text-danger {
    color: var(--danger);
}

.text-warning {
    color: var(--warning);
}

.text-center {
    text-align: center;
}

.mb-0 {
    margin-bottom: 0;
}

.mt-1 {
    margin-top: 0.25rem;
}

.mt-2 {
    margin-top: 0.5rem;
}

.mt-3 {
    margin-top: 1rem;
}

.mt-4 {
    margin-top: 1.5rem;
}

.mt-5 {
    margin-top: 2rem;
}

.p-0 {
    padding: 0;
}

.d-none {
    display: none;
}

.d-flex {
    display: flex;
}

.align-items-center {
    align-items: center;
}

.justify-content-between {
    justify-content: space-between;
}

.w-100 {
    width: 100%;
}

/* Preloader for initial loading */
.preloader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--light);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    transition: opacity 0.5s ease, visibility 0.5s ease;
}

.preloader.fade-out {
    opacity: 0;
    visibility: hidden;
}

.preloader-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
}

.preloader-logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--primary);
}

.preloader-spinner {
    width: 50px;
    height: 50px;
    border: 5px solid rgba(59, 130, 246, 0.2);
    border-radius: 50%;
    border-top-color: var(--primary);
    animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

body.dark-mode .preloader {
    background-color: var(--dark);
}
</style>
</head>

<body class="">
    <!-- Preloader -->
    <div class="preloader">
        <div class="preloader-content">
            <div class="preloader-logo">
                <i class="fas fa-search-plus"></i>
                <span>Web Research Agent Pro</span>
            </div>
            <div class="preloader-spinner"></div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container header-container">
            <a href="#" class="logo">
                <i class="fas fa-search-plus logo-icon"></i>
                <span class="logo-text">Web <span>Research</span> Agent Pro</span>
            </a>
            <div class="header-controls">
                <button class="theme-toggle" aria-label="Toggle Dark Mode"><i class="fas fa-moon"></i></button>
                <div class="user-profile">
                    <div class="user-avatar">KR</div>
                    <div class="user-info">
                        <span class="user-name">Kevin Reynolds</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- Query Form -->
        <form class="card query-form">
            <div class="card-header">
                <h2 class="card-title"><i class="fas fa-search"></i> Research Query</h2>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label for="queryInput">What would you like to research?</label>
                    <textarea id="queryInput" class="form-control" placeholder="Enter your research query here... (e.g., 'What are the latest developments in quantum computing?', 'Compare and contrast different renewable energy sources', etc.)"></textarea>
                </div>
                
                <div class="advanced-toggle">
                    <i class="fas fa-chevron-down"></i> Advanced Search Options
                </div>
                
                <div class="advanced-search">
                    <div class="advanced-options">
                        <div class="search-filter">
                            <label for="timeRange">Time Range</label>
                            <select id="timeRange" class="form-select">
                                <option value="all">All Time</option>
                                <option value="day">Past 24 Hours</option>
                                <option value="week">Past Week</option>
                                <option value="month">Past Month</option>
                                <option value="year">Past Year</option>
                                <option value="custom">Custom Range</option>
                            </select>
                            
                            <div class="date-range mt-2 d-none" id="customDateRange">
                                <div>
                                    <label for="startDate">From</label>
                                    <input type="date" id="startDate" class="form-control">
                                </div>
                                <div>
                                    <label for="endDate">To</label>
                                    <input type="date" id="endDate" class="form-control">
                                </div>
                            </div>
                        </div>
                        
                        <div class="search-filter">
                            <label for="sourceType">Source Types</label>
                            <div class="checkbox-group">
                                <label class="checkbox-item">
                                    <input type="checkbox" id="academicSources" checked>
                                    Academic
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" id="newsSources" checked>
                                    News
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" id="blogsSources" checked>
                                    Blogs
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" id="govSources" checked>
                                    Government
                                </label>
                            </div>
                        </div>
                        
                        <div class="search-filter">
                            <label for="researchDepth">Research Depth</label>
                            <select id="researchDepth" class="form-select">
                                <option value="standard">Standard</option>
                                <option value="comprehensive">Comprehensive</option>
                                <option value="expert">Expert Level</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="controls">
                    <div class="provider-select">
                        <label for="providerSelect">AI Provider:</label>
                        <select id="providerSelect" class="form-select">
                            <option value="openai">OpenAI GPT-4</option>
                            <option value="anthropic">Anthropic Claude</option>
                            <option value="google">Google Gemini</option>
                        </select>
                    </div>
                    <div class="button-group">
                        <button type="button" id="resetBtn" class="btn btn-danger">
                            <i class="fas fa-trash-alt"></i> Reset
                        </button>
                        <button type="button" id="submitBtn" class="btn btn-primary">
                            <i class="fas fa-search"></i> Research
                        </button>
                    </div>
                </div>
            </div>
        </form>

        <!-- Loading State - Modified to only show progress bar during phases -->
        <div id="loading" class="loading card">
            <div class="loading-content">
                <div class="loading-progress">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                <div class="loading-phases">
                    <span class="phase active" id="phase1">Connecting</span>
                    <span class="phase" id="phase2">Fetching</span>
                    <span class="phase" id="phase3">Analyzing</span>
                    <span class="phase" id="phase4">Rendering</span>
                </div>
                <p class="loading-message" id="loadingMessage">Researching your query... This may take a moment.</p>
            </div>
        </div>

        <!-- Results -->
        <section id="results" class="results">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-chart-line"></i> Research Results</h2>
                </div>
                <div class="card-body">
                    <div class="result-header">
                        <h2 class="result-title">Research Results</h2>
                        <div class="confidence-meter">
                            <span class="confidence-label">Confidence:</span>
                            <div class="confidence-bar"><div id="confidenceValue" class="confidence-value"></div></div>
                            <span id="confidencePercent" class="confidence-percent">0%</span>
                        </div>
                    </div>
                    <div class="result-metadata">
                        <div class="meta-item"><i class="fas fa-tag"></i><span class="meta-item-label">Query Type:</span><span class="meta-item-value" id="queryType">Factual</span></div>
                        <div class="meta-item"><i class="fas fa-layer-group"></i><span class="meta-item-label">Depth:</span><span class="meta-item-value" id="depth">Standard</span></div>
                        <div class="meta-item"><i class="fas fa-filter"></i><span class="meta-item-label">Source Types:</span><span class="meta-item-value" id="sourceTypes">All</span></div>
                        <div class="meta-item"><i class="fas fa-clock"></i><span class="meta-item-label">Time:</span><span class="meta-item-value" id="timestamp"></span></div>
                    </div>

                    <div class="tab-buttons">
                        <button id="summaryTab" class="tab-btn active">Summary</button>
                        <button id="detailedTab" class="tab-btn">Detailed Response</button>
                    </div>

                    <div id="summaryContent" class="tab-content">
                        <div id="summary" class="summary"></div>
                        <div class="highlights">
                            <h3 class="highlights-title"><i class="fas fa-lightbulb"></i> Key Highlights</h3>
                            <div id="highlightsList">
                                <!-- Highlights will be inserted here dynamically -->
                            </div>
                        </div>
                        
                        <div class="tag-cloud">
                            <!-- Tags will be inserted here dynamically -->
                        </div>
                    </div>

                    <div id="detailedContent" class="tab-content detail-content">
                        <!-- Detailed content will be inserted here dynamically -->
                    </div>
                </div>
            </div>

            <!-- Sources Card -->
            <div class="card sources-card">
                <div class="card-header">
                    <div class="sources-header">
                        <h3 class="sources-title"><i class="fas fa-book"></i> Sources</h3>
                        <span class="source-count" id="sourceCount">0 sources</span>
                    </div>
                </div>
                <div class="card-body">
                    <ul id="sourcesList" class="source-list">
                        <!-- Sources will be inserted here dynamically -->
                    </ul>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <a href="https://yuvrajtechsphere.vercel.app" class="footer-logo"><i class="fas fa-search"></i> Web Research Agent Pro</a>
                <p class="footer-copyright">© 2025 Web Research Agent Pro</p>
                <div class="footer-links">
                    <a href="https://yuvrajtechsphere.vercel.app" class="footer-link">Privacy</a>
                    <a href="https://yuvrajtechsphere.vercel.app" class="footer-link">Terms</a>
                    <a href="https://yuvrajtechsphere.vercel.app" class="footer-link">Support</a>
                    <a href="https://yuvrajtechsphere.vercel.app" class="footer-link">API</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Remove preloader after page loads
            setTimeout(() => {
                const preloader = document.querySelector('.preloader');
                preloader.classList.add('fade-out');
                setTimeout(() => { preloader.style.display = 'none'; }, 500);
            }, 1000);
            
            // DOM Elements
            const queryInput = document.getElementById('queryInput');
            const providerSelect = document.getElementById('providerSelect');
            const submitBtn = document.getElementById('submitBtn');
            const resetBtn = document.getElementById('resetBtn');
            const resultsDiv = document.getElementById('results');
            const summaryDiv = document.getElementById('summary');
            const detailedContent = document.getElementById('detailedContent');
            const sourcesList = document.getElementById('sourcesList');
            const loadingDiv = document.getElementById('loading');
            const highlightsList = document.getElementById('highlightsList');
            const queryTypeSpan = document.getElementById('queryType');
            const depthSpan = document.getElementById('depth');
            const sourceTypesSpan = document.getElementById('sourceTypes');
            const timestampSpan = document.getElementById('timestamp');
            const sourceCount = document.getElementById('sourceCount');
            const confidenceValue = document.getElementById('confidenceValue');
            const confidencePercent = document.getElementById('confidencePercent');
            const summaryTab = document.getElementById('summaryTab');
            const detailedTab = document.getElementById('detailedTab');
            const summaryContent = document.getElementById('summaryContent');
            const progressBar = document.getElementById('progressBar');
            const loadingMessage = document.getElementById('loadingMessage');
            const phases = document.querySelectorAll('.phase');
            const themeToggle = document.querySelector('.theme-toggle');
            const advancedToggle = document.querySelector('.advanced-toggle');
            const advancedSearch = document.querySelector('.advanced-search');
            const timeRangeSelect = document.getElementById('timeRange');
            const customDateRange = document.getElementById('customDateRange');
            const researchDepth = document.getElementById('researchDepth');
            
            // Set current timestamp
            const now = new Date();
            timestampSpan.textContent = now.toLocaleString();
            
            // Theme Toggle
            themeToggle.addEventListener('click', function() {
                document.body.classList.toggle('dark-mode');
                const isDarkMode = document.body.classList.contains('dark-mode');
                themeToggle.innerHTML = isDarkMode ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
                localStorage.setItem('darkMode', isDarkMode ? 'enabled' : 'disabled');
            });
            
            // Check for saved theme preference
            if (localStorage.getItem('darkMode') === 'enabled') {
                document.body.classList.add('dark-mode');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            }
            
            // Advanced Search Toggle
            advancedToggle.addEventListener('click', function() {
                advancedToggle.classList.toggle('open');
                advancedSearch.classList.toggle('show');
            });
            
            // Custom Date Range Toggle
            timeRangeSelect.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customDateRange.classList.remove('d-none');
                } else {
                    customDateRange.classList.add('d-none');
                }
            });
            
            // Tab functionality
            summaryTab.addEventListener('click', function() {
                summaryTab.classList.add('active');
                detailedTab.classList.remove('active');
                summaryContent.style.display = 'block';
                detailedContent.style.display = 'none';
            });
            
            detailedTab.addEventListener('click', function() {
                detailedTab.classList.add('active');
                summaryTab.classList.remove('active');
                summaryContent.style.display = 'none';
                detailedContent.style.display = 'block';
            });
            
            // Initialize tabs
            summaryContent.style.display = 'block';
            detailedContent.style.display = 'none';
            
            // Header scroll effect
            window.addEventListener('scroll', function() {
                const header = document.querySelector('header');
                if (window.scrollY > 10) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
            });
            
            // Submit button - Research API call
            submitBtn.addEventListener('click', async function() {
                const query = queryInput.value.trim();
                if (!query) {
                    alert('Please enter a research query');
                    return;
                }
                
                // Show loading state with phases
                loadingDiv.style.display = 'block';
                resultsDiv.style.display = 'none';
                submitBtn.disabled = true;
                
                // Reset phases
                phases.forEach((phase, i) => {
                    if (i === 0) {
                        phase.classList.add('active');
                    } else {
                        phase.classList.remove('active');
                    }
                });
                
                // Start progress animation
                let progress = 0;
                let currentPhase = 0;
                progressBar.style.width = '0%';
                
                const interval = setInterval(() => {
                    progress += Math.random() * 3;
                    if (progress >= 100) {
                        progress = 100;
                        clearInterval(interval);
                    }
                    
                    // Update progress bar
                    progressBar.style.width = `${progress}%`;
                    
                    // Update phases
                    if (progress >= 25 && currentPhase < 1) {
                        updatePhase(1);
                        currentPhase = 1;
                        loadingMessage.textContent = "Gathering information from reliable sources...";
                    } else if (progress >= 50 && currentPhase < 2) {
                        updatePhase(2);
                        currentPhase = 2;
                        loadingMessage.textContent = "Analyzing data and cross-referencing sources...";
                    } else if (progress >= 75 && currentPhase < 3) {
                        updatePhase(3);
                        currentPhase = 3;
                        loadingMessage.textContent = "Compiling results and preparing your response...";
                    }
                }, 150);
                
                // Prepare API request data
                const requestData = {
                    query: query,
                    provider: providerSelect.value,
                    depth: researchDepth.value,
                    time_range: timeRangeSelect.value
                };
                
                // Add custom date range if selected
                if (timeRangeSelect.value === 'custom') {
                    requestData.start_date = document.getElementById('startDate').value;
                    requestData.end_date = document.getElementById('endDate').value;
                }
                
                // Add source types
                requestData.source_types = {
                    academic: document.getElementById('academicSources').checked,
                    news: document.getElementById('newsSources').checked,
                    blogs: document.getElementById('blogsSources').checked,
                    government: document.getElementById('govSources').checked
                };
                
                try {
                    const response = await fetch('/api/research', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(requestData)
                    });
                    
                    const result = await response.json();
                    
                    // Clear interval and complete loading animation
                    clearInterval(interval);
                    progressBar.style.width = '100%';
                    updatePhase(3);
                    
                    // Delay for UI smoothness
                    setTimeout(() => {
                        loadingDiv.style.display = 'none';
                        
                        if (result.success) {
                            renderResults(result, requestData);
                            resultsDiv.style.display = 'block';
                        } else {
                            alert(`Error: ${result.message || 'Unknown error occurred'}`);
                        }
                        
                        submitBtn.disabled = false;
                    }, 500);
                    
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred while processing your request.');
                    loadingDiv.style.display = 'none';
                    submitBtn.disabled = false;
                    clearInterval(interval);
                }
            });
            
            // Reset button functionality
            resetBtn.addEventListener('click', async function() {
                try {
                    const response = await fetch('/api/reset', { method: 'POST' });
                    const result = await response.json();
                    
                    queryInput.value = '';
                    resultsDiv.style.display = 'none';
                    
                    // Show success feedback
                    const feedbackDiv = document.createElement('div');
                    feedbackDiv.style.padding = '1rem';
                    feedbackDiv.style.marginTop = '1rem';
                    feedbackDiv.style.backgroundColor = '#ecfdf5';
                    feedbackDiv.style.color = '#064e3b';
                    feedbackDiv.style.borderRadius = '0.375rem';
                    feedbackDiv.style.textAlign = 'center';
                    feedbackDiv.innerHTML = '<i class="fas fa-check-circle"></i> Conversation history has been reset.';
                    document.querySelector('.query-form').appendChild(feedbackDiv);
                    
                    setTimeout(() => { feedbackDiv.remove(); }, 3000);
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred while resetting the conversation.');
                }
            });
            
            function updatePhase(phaseNum) {
                phases.forEach((phase, i) => {
                    if (i <= phaseNum) {
                        phase.classList.add('active');
                    } else {
                        phase.classList.remove('active');
                    }
                });
            }
            
            function renderResults(result, requestData) {
                // Set metadata from form selections
                queryTypeSpan.textContent = result.analysis?.query_type?.charAt(0).toUpperCase() + result.analysis?.query_type?.slice(1) || 'Factual';
                
                // Use the selected depth from the form
                depthSpan.textContent = requestData.depth.charAt(0).toUpperCase() + requestData.depth.slice(1);
                
                // Set source types metadata based on selected checkboxes
                const selectedSourceTypes = [];
                if (requestData.source_types.academic) selectedSourceTypes.push('Academic');
                if (requestData.source_types.news) selectedSourceTypes.push('News');
                if (requestData.source_types.blogs) selectedSourceTypes.push('Blogs');
                if (requestData.source_types.government) selectedSourceTypes.push('Government');
                
                sourceTypesSpan.textContent = selectedSourceTypes.length > 0 ? selectedSourceTypes.join(', ') : 'All';
                
                timestampSpan.textContent = new Date().toLocaleString();
                
                // Set confidence score
                const confidenceScore = calculateConfidence(result);
                confidenceValue.style.width = `${confidenceScore}%`;
                confidencePercent.textContent = `${confidenceScore}%`;
                
                // Set summary content
                summaryDiv.innerHTML = formatContent(result.summary);
                
                // Set detailed content if available
                if (result.detailed_response && result.detailed_response.trim()) {
                    detailedContent.innerHTML = formatContent(result.detailed_response);
                    detailedTab.style.display = 'block';
                } else {
                    detailedTab.style.display = 'none';
                }
                
                // Set highlights
                highlightsList.innerHTML = '';
                if (result.highlights && result.highlights.length > 0) {
                    result.highlights.forEach(highlight => {
                        const div = document.createElement('div');
                        div.className = 'highlight-item';
                        div.innerHTML = `<i class="fas fa-circle"></i><span>${highlight}</span>`;
                        highlightsList.appendChild(div);
                    });
                } else {
                    generateHighlights(result.summary || '');
                }
                
                // Set sources
                sourcesList.innerHTML = '';
                if (result.sources && result.sources.length > 0) {
                    sourceCount.textContent = `${result.sources.length} sources`;
                    
                    result.sources.forEach((source, index) => {
                        const relevanceScore = source.relevance_score || (95 - (index * 7));
                        const adjustedScore = Math.max(30, Math.min(100, relevanceScore));
                        
                        const li = document.createElement('li');
                        li.className = 'source-item';
                        li.innerHTML = `
                            <div class="source-icon"><i class="fas ${getSourceIcon(source.url)}"></i></div>
                            <div class="source-content">
                                <div class="source-title">${source.title || 'Untitled Source'}</div>
                                <div class="source-url"><a href="${source.url}" target="_blank">${source.url}</a></div>
                                <div class="relevance-bar"><div class="relevance-value" style="width: ${adjustedScore}%"></div></div>
                                <div class="relevance-label"><span>Relevance</span><span>${adjustedScore}%</span></div>
                            </div>
                        `;
                        sourcesList.appendChild(li);
                    });
                } else {
                    sourceCount.textContent = '0 sources';
                    sourcesList.innerHTML = '<li class="no-sources">No sources available</li>';
                }
                
                // Generate tags
                generateTags(result.summary || queryInput.value.trim());
                
                // Show summary tab by default
                summaryTab.click();
            }
            
            function calculateConfidence(result) {
                let score = 75; // Base confidence score
                
                // Adjust based on sources
                if (result.sources && result.sources.length > 0) {
                    score += Math.min(15, result.sources.length * 3);
                } else {
                    score -= 20;
                }
                
                // Adjust based on source evaluation
                if (result.source_evaluation) {
                    if (result.source_evaluation.contradictions && result.source_evaluation.contradictions.includes('contradiction')) {
                        score -= 10;
                    }
                    if (result.source_evaluation.information_gaps && result.source_evaluation.information_gaps.includes('gap')) {
                        score -= 5;
                    }
                }
                
                // Return final score within bounds
                return Math.min(98, Math.max(35, Math.round(score)));
            }
            
            function formatContent(content) {
                if (!content) return '';
                
                // Handle line breaks
                let formatted = content.replace(/\n/g, '<br>');
                
                // Handle bold and italic formatting
                formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                formatted = formatted.replace(/\*(.*?)\*/g, '<em>$1</em>');
                
                // Handle source references
                formatted = formatted.replace(/\[Source (\d+)\]/g, '<span class="source-reference">[Source $1]</span>');
                
                // Handle headers if using markdown
                formatted = formatted.replace(/## (.*?)$/gm, '<h3>$1</h3>');
                formatted = formatted.replace(/### (.*?)$/gm, '<h4>$1</h4>');
                
                return formatted;
            }
            
            function generateHighlights(text) {
                // Extract key sentences if no highlights provided
                if (!text) return;
                
                const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 20);
                const selectedSentences = sentences.slice(0, Math.min(5, sentences.length));
                
                selectedSentences.forEach(sentence => {
                    const div = document.createElement('div');
                    div.className = 'highlight-item';
                    div.innerHTML = `<i class="fas fa-circle"></i><span>${sentence.trim()}.</span>`;
                    highlightsList.appendChild(div);
                });
            }
            
            function generateTags(text) {
                // Generate tags from text content
                const tagCloud = document.querySelector('.tag-cloud');
                tagCloud.innerHTML = '';
                
                if (!text) return;
                
                // Extract potential keywords
                const words = text.toLowerCase().split(/\W+/).filter(w => w.length > 3);
                const wordCounts = {};
                
                words.forEach(word => {
                    if (!wordCounts[word]) wordCounts[word] = 0;
                    wordCounts[word]++;
                });
                
                // Sort by frequency
                const sortedWords = Object.keys(wordCounts).sort((a, b) => wordCounts[b] - wordCounts[a]);
                
                // Take top words but exclude common stop words
                const stopWords = ['this', 'that', 'there', 'their', 'these', 'those', 'with', 'from'];
                const topWords = sortedWords
                    .filter(word => !stopWords.includes(word))
                    .slice(0, 5);
                
                // Add tags to cloud
                topWords.forEach(tag => {
                    const capitalizedTag = tag.charAt(0).toUpperCase() + tag.slice(1);
                    const tagElement = document.createElement('div');
                    tagElement.className = 'tag';
                    tagElement.innerHTML = `<i class="fas fa-tag"></i> ${capitalizedTag}`;
                    tagCloud.appendChild(tagElement);
                });
            }
            
            function getSourceIcon(url) {
                if (!url) return 'fa-globe';
                if (url.includes('linkedin.com')) return 'fa-linkedin';
                if (url.includes('researchgate.net')) return 'fa-flask';
                if (url.includes('scholar.google.com')) return 'fa-graduation-cap';
                if (url.includes('twitter.com') || url.includes('x.com')) return 'fa-twitter';
                if (url.includes('github.com')) return 'fa-github';
                if (url.includes('youtube.com')) return 'fa-youtube';
                if (url.includes('wikipedia.org')) return 'fa-wikipedia-w';
                if (url.includes('edu')) return 'fa-university';
                if (url.includes('gov')) return 'fa-landmark';
                return 'fa-globe';
            }
            
            // Example query suggestions for placeholder text
            const exampleQueries = [
                "What are the latest developments in quantum computing?",
                "How does climate change affect biodiversity?",
                "Compare different renewable energy sources",
                "What are the ethical implications of AI in healthcare?",
                "Analyze the economic impact of remote work trends"
            ];
            
            // Set random example as placeholder
            queryInput.placeholder = exampleQueries[Math.floor(Math.random() * exampleQueries.length)];
        });
    </script>
    
    <style>
        /* Add these CSS rules to fix dark mode text visibility */
        body.dark-mode .summary,
        body.dark-mode .detail-content {
            color: #fff;
        }
        
        /* Add spacing between Sources title and source count */
        .sources-header {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .source-count {
            color: #666;
            font-size: 0.9rem;
        }
        
        body.dark-mode .source-count {
            color: #aaa;
        }

        /* Add this CSS to change the source reference color to a bluish color */
        .source-reference {
            color: #2c7be5;
            font-weight: 600;
            text-decoration: none;
        }

        .source-reference:hover {
            text-decoration: underline;
            color: #1a56a2;
        }
    </style>
</body>